# 比赛录入系统设计文档

## 1. 需求分析

### 1.1 业务场景
- 每场比赛分为 **4节**
- **计分规则**：
  - 第1、2节：每节获胜得 **1分**
  - 第3、4节：每节获胜得 **2分**
  - 最终得分 = 各节得分之和（最高8分）
- **录入需求**：
  - 需要记录每节的进球详情（进球者、助攻者、时间）
  - 需要统计每节比分
  - 需要统计最终得分
  - 支持手动录入和AI识别导入两种方式

### 1.2 简报解析需求
从文字简报中提取：
- 基本信息：队伍名称、日期、地点、最终比分
- 到场人员列表
- 各节比赛详情和进球事件
- 数据统计（进球、助攻、裁判次数、门将扑救）
- MVP候选人

---

## 2. 数据库设计

### 2.1 修改 `matches` 表
```sql
ALTER TABLE matches ADD COLUMN `quarter_system` BOOLEAN DEFAULT false
  COMMENT '是否使用4节制（true=4节制，false=传统全场制）';
ALTER TABLE matches ADD COLUMN `final_team1_score` INT DEFAULT 0
  COMMENT '队伍1最终得分（4节制累计分数）';
ALTER TABLE matches ADD COLUMN `final_team2_score` INT DEFAULT 0
  COMMENT '队伍2最终得分（4节制累计分数）';
```

### 2.2 新增 `match_quarters` 表（比赛节次表）
```sql
CREATE TABLE `match_quarters` (
  `id` CHAR(36) PRIMARY KEY,
  `match_id` CHAR(36) NOT NULL COMMENT '比赛ID',
  `quarter_number` TINYINT NOT NULL COMMENT '节次编号 1-4',
  `team1_goals` INT DEFAULT 0 COMMENT '队伍1进球数',
  `team2_goals` INT DEFAULT 0 COMMENT '队伍2进球数',
  `team1_points` INT DEFAULT 0 COMMENT '队伍1本节得分（1或2分）',
  `team2_points` INT DEFAULT 0 COMMENT '队伍2本节得分（0、1或2分）',
  `duration_minutes` INT DEFAULT 20 COMMENT '节次时长（分钟）',
  `summary` TEXT COMMENT '本节文字总结',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_match_quarter` (`match_id`, `quarter_number`),
  INDEX `idx_match_id` (`match_id`),
  FOREIGN KEY (`match_id`) REFERENCES `matches`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='比赛节次表';
```

### 2.3 修改 `match_events` 表
添加字段以支持节次和更详细的统计：
```sql
ALTER TABLE match_events ADD COLUMN `quarter_number` TINYINT
  COMMENT '发生在第几节（1-4）';
ALTER TABLE match_events ADD COLUMN `event_subtype` VARCHAR(20)
  COMMENT '事件子类型（如：far_shot远射, penalty点球, corner_kick角球）';
```

扩展 `event_type` 枚举：
```sql
ALTER TABLE match_events MODIFY COLUMN `event_type`
  ENUM('goal', 'assist', 'save', 'yellow_card', 'red_card',
       'substitution_in', 'substitution_out', 'referee')
  NOT NULL COMMENT '事件类型（新增save扑救、referee裁判）';
```

### 2.4 新增 `match_participants` 表（到场人员表）
```sql
CREATE TABLE `match_participants` (
  `id` CHAR(36) PRIMARY KEY,
  `match_id` CHAR(36) NOT NULL COMMENT '比赛ID',
  `team_id` CHAR(36) NOT NULL COMMENT '队伍ID',
  `user_id` CHAR(36) NOT NULL COMMENT '用户ID',
  `is_present` BOOLEAN DEFAULT true COMMENT '是否到场',
  `arrival_time` TIMESTAMP COMMENT '到场时间',
  `notes` VARCHAR(255) COMMENT '备注',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_match_team_user` (`match_id`, `team_id`, `user_id`),
  INDEX `idx_match_id` (`match_id`),
  FOREIGN KEY (`match_id`) REFERENCES `matches`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`team_id`) REFERENCES `teams`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='比赛到场人员表';
```

### 2.5 修改 `match_results` 表
```sql
ALTER TABLE match_results ADD COLUMN `quarter_system` BOOLEAN DEFAULT false
  COMMENT '是否4节制';
ALTER TABLE match_results ADD COLUMN `team1_final_score` INT
  COMMENT '队伍1最终得分（4节制）';
ALTER TABLE match_results ADD COLUMN `team2_final_score` INT
  COMMENT '队伍2最终得分（4节制）';
ALTER TABLE match_results ADD COLUMN `team1_total_goals` INT
  COMMENT '队伍1总进球数';
ALTER TABLE match_results ADD COLUMN `team2_total_goals` INT
  COMMENT '队伍2总进球数';
ALTER TABLE match_results ADD COLUMN `raw_report` TEXT
  COMMENT '原始简报文本';
ALTER TABLE match_results ADD COLUMN `parsed_by_ai` BOOLEAN DEFAULT false
  COMMENT '是否由AI解析导入';
```

---

## 3. 数据结构设计

### 3.1 计分逻辑
```javascript
// 节次得分计算规则
const QUARTER_POINTS = {
  1: { win: 1, draw: 0 },  // 第1节获胜得1分
  2: { win: 1, draw: 0 },  // 第2节获胜得1分
  3: { win: 2, draw: 0 },  // 第3节获胜得2分
  4: { win: 2, draw: 0 }   // 第4节获胜得2分
};

// 单节得分计算
function calculateQuarterPoints(quarterNumber, team1Goals, team2Goals) {
  const rule = QUARTER_POINTS[quarterNumber];
  if (team1Goals > team2Goals) {
    return { team1Points: rule.win, team2Points: 0 };
  } else if (team2Goals > team1Goals) {
    return { team1Points: 0, team2Points: rule.win };
  } else {
    return { team1Points: rule.draw, team2Points: rule.draw };
  }
}

// 最终得分 = 各节得分之和
function calculateFinalScore(quarters) {
  let team1FinalScore = 0;
  let team2FinalScore = 0;

  quarters.forEach(q => {
    team1FinalScore += q.team1Points;
    team2FinalScore += q.team2Points;
  });

  return { team1FinalScore, team2FinalScore };
}
```

### 3.2 数据存储示例

**比赛基本信息**:
```json
{
  "matchId": "match-uuid",
  "title": "嘉陵摩托（红）VS 长江（花）",
  "team1Id": "team-red-uuid",
  "team2Id": "team-flower-uuid",
  "matchDate": "2025-10-12T14:00:00.000Z",
  "location": "轨道集团",
  "quarterSystem": true,
  "finalTeam1Score": 3,
  "finalTeam2Score": 0,
  "status": "completed"
}
```

**节次数据**:
```json
[
  {
    "quarterId": "q1-uuid",
    "matchId": "match-uuid",
    "quarterNumber": 1,
    "team1Goals": 3,
    "team2Goals": 2,
    "team1Points": 1,
    "team2Points": 0,
    "summary": "第一节嘉陵江边后卫小刘远射..."
  },
  {
    "quarterNumber": 2,
    "team1Goals": 2,
    "team2Goals": 2,
    "team1Points": 0,
    "team2Points": 0,
    "summary": "第二节川哥、二筒上场..."
  },
  {
    "quarterNumber": 3,
    "team1Goals": 1,
    "team2Goals": 1,
    "team1Points": 0,
    "team2Points": 0,
    "summary": "第三节，川哥继续冲刺..."
  },
  {
    "quarterNumber": 4,
    "team1Goals": 2,
    "team2Goals": 0,
    "team1Points": 2,
    "team2Points": 0,
    "summary": "第四节决战..."
  }
]
```

**比赛事件**:
```json
[
  {
    "eventId": "event-uuid-1",
    "matchId": "match-uuid",
    "quarterNumber": 1,
    "teamId": "team-red-uuid",
    "userId": "user-xiaoliu-uuid",
    "eventType": "goal",
    "eventSubtype": "far_shot",
    "minute": 5,
    "assistUserId": null,
    "notes": "边后卫远射"
  },
  {
    "eventId": "event-uuid-2",
    "matchId": "match-uuid",
    "quarterNumber": 1,
    "teamId": "team-red-uuid",
    "userId": "user-hongsheng-uuid",
    "eventType": "goal",
    "minute": 18,
    "assistUserId": "user-mutou-uuid",
    "notes": "反插进禁区"
  },
  {
    "eventId": "event-uuid-3",
    "matchId": "match-uuid",
    "quarterNumber": 4,
    "teamId": "team-red-uuid",
    "userId": "user-yongjian-uuid",
    "eventType": "save",
    "minute": 85,
    "notes": "扑救3次"
  }
]
```

**到场人员**:
```json
[
  {
    "participantId": "part-uuid-1",
    "matchId": "match-uuid",
    "teamId": "team-red-uuid",
    "userId": "user-huangbo-uuid",
    "isPresent": true,
    "notes": "替补登场"
  }
]
```

---

## 4. API接口设计

### 4.1 比赛录入接口

#### 4.1.1 创建4节制比赛
```
POST /api/match/create
```

**请求体**:
```json
{
  "title": "嘉陵摩托 vs 长江",
  "team1Id": "team-uuid-1",
  "team2Id": "team-uuid-2",
  "matchDate": "2025-10-12T14:00:00Z",
  "location": "轨道集团",
  "quarterSystem": true
}
```

#### 4.1.2 录入节次数据
```
POST /api/match/:matchId/quarter
```

**请求体**:
```json
{
  "quarterNumber": 1,
  "team1Goals": 3,
  "team2Goals": 2,
  "events": [
    {
      "userId": "user-uuid",
      "teamId": "team-uuid",
      "eventType": "goal",
      "minute": 5,
      "assistUserId": "user-uuid-2",
      "notes": "远射破门"
    }
  ],
  "summary": "第一节比赛精彩纷呈..."
}
```

**响应**:
```json
{
  "code": 0,
  "success": true,
  "data": {
    "quarter": {
      "id": "quarter-uuid",
      "quarterNumber": 1,
      "team1Goals": 3,
      "team2Goals": 2,
      "team1Points": 1,
      "team2Points": 0
    },
    "events": [...],
    "currentScore": {
      "team1FinalScore": 1,
      "team2FinalScore": 0
    }
  }
}
```

#### 4.1.3 批量录入完整比赛
```
POST /api/match/:matchId/complete-quarters
```

**请求体**:
```json
{
  "quarters": [
    {
      "quarterNumber": 1,
      "team1Goals": 3,
      "team2Goals": 2,
      "summary": "...",
      "events": [...]
    },
    {
      "quarterNumber": 2,
      "team1Goals": 2,
      "team2Goals": 2,
      "summary": "...",
      "events": [...]
    },
    {
      "quarterNumber": 3,
      "team1Goals": 1,
      "team2Goals": 1,
      "summary": "...",
      "events": [...]
    },
    {
      "quarterNumber": 4,
      "team1Goals": 2,
      "team2Goals": 0,
      "summary": "...",
      "events": [...]
    }
  ],
  "participants": {
    "team1": ["user-id-1", "user-id-2"],
    "team2": ["user-id-3", "user-id-4"]
  },
  "mvpUserIds": ["user-id-1", "user-id-5"],
  "summary": "比赛总结"
}
```

#### 4.1.4 AI简报解析接口
```
POST /api/match/parse-report
```

**请求体**:
```json
{
  "reportText": "嘉陵摩托（红）VS 长江（花）星期六2025.10.12，轨道集团 比分:3:0\n\n到场人员：\n花：待补充\n红： 黄波 施毅 洪胜...",
  "autoCreate": true
}
```

**响应**:
```json
{
  "code": 0,
  "success": true,
  "data": {
    "parsed": {
      "basicInfo": {
        "team1Name": "嘉陵摩托",
        "team1Alias": "红",
        "team2Name": "长江",
        "team2Alias": "花",
        "date": "2025-10-12",
        "location": "轨道集团",
        "finalScore": "3:0"
      },
      "participants": {
        "team1": ["黄波", "施毅", "洪胜", "王鑫", "木头", ...],
        "team2": ["待补充"]
      },
      "quarters": [
        {
          "quarterNumber": 1,
          "team1Goals": 3,
          "team2Goals": 2,
          "summary": "第一节嘉陵江边后卫小刘远射..."
        }
      ],
      "statistics": {
        "银河": { "assists": 1, "referee": 2 },
        "洪胜": { "goals": 4, "assists": 2 },
        "永健": { "referee": 1, "saves": 3 }
      },
      "mvp": ["洪胜", "施毅", "小黑", "曹枫"]
    },
    "matchId": "created-match-uuid"
  }
}
```

### 4.2 查询接口

#### 4.2.1 获取比赛详情（含节次）
```
GET /api/match/:matchId/detail
```

**响应**:
```json
{
  "code": 0,
  "success": true,
  "data": {
    "match": {
      "id": "match-uuid",
      "title": "嘉陵摩托 vs 长江",
      "quarterSystem": true,
      "finalTeam1Score": 3,
      "finalTeam2Score": 0
    },
    "quarters": [
      {
        "quarterNumber": 1,
        "team1Goals": 3,
        "team2Goals": 2,
        "team1Points": 1,
        "team2Points": 0,
        "summary": "..."
      }
    ],
    "events": [...],
    "participants": {
      "team1": [...],
      "team2": [...]
    },
    "result": {
      "team1TotalGoals": 8,
      "team2TotalGoals": 5,
      "team1FinalScore": 3,
      "team2FinalScore": 0,
      "winnerTeamId": "team-uuid-1"
    }
  }
}
```

#### 4.2.2 获取球员比赛统计
```
GET /api/match/:matchId/player-stats
```

**响应**:
```json
{
  "code": 0,
  "success": true,
  "data": [
    {
      "userId": "user-uuid",
      "nickname": "洪胜",
      "goals": 4,
      "assists": 2,
      "saves": 0,
      "refereeCount": 0,
      "quarters": [1, 2, 3, 4]
    }
  ]
}
```

---

## 5. 前端录入页面设计

### 5.1 录入方式选择
```
┌─────────────────────────────────┐
│   选择录入方式                   │
├─────────────────────────────────┤
│  ○ 手动逐节录入                 │
│  ○ AI简报解析导入               │
│  ○ 快速录入（仅比分）           │
└─────────────────────────────────┘
```

### 5.2 手动逐节录入界面

**步骤1: 基本信息**
```
比赛信息
├── 队伍1: [下拉选择]  别名: [红/蓝/...]
├── 队伍2: [下拉选择]  别名: [花/...]
├── 比赛日期: [日期选择器]
├── 比赛地点: [文本输入]
└── ☑ 使用4节制计分
```

**步骤2: 到场人员**
```
队伍1到场人员: [多选checkbox]
□ 黄波  □ 施毅  □ 洪胜  □ 王鑫  ...

队伍2到场人员: [多选checkbox]
□ 夏雷雨  □ 小黑  □ 永健  ...
```

**步骤3: 节次录入（循环4次）**
```
┌─────────────────────────────────┐
│   第 1 节                        │
├─────────────────────────────────┤
│ 队伍1进球: [2] ⚽               │
│ 队伍2进球: [1] ⚽               │
│                                  │
│ 进球事件:                        │
│ ┌─────────────────────────────┐ │
│ │ 1. 洪胜 (5') [助攻: 木头]   │ │
│ │ 2. 黄波 (15')               │ │
│ │ [+ 添加进球]                │ │
│ └─────────────────────────────┘ │
│                                  │
│ 本节总结: [文本框]              │
│                                  │
│ 本节得分: 队伍1 +1分  队伍2 +0分│
└─────────────────────────────────┘

[上一节] [保存本节] [下一节]
```

**步骤4: 统计与确认**
```
┌─────────────────────────────────┐
│   比赛总结                       │
├─────────────────────────────────┤
│ 各节进球:                        │
│   第1节: 3-2 (红+1分)           │
│   第2节: 2-2 (平局)              │
│   第3节: 1-1 (平局)              │
│   第4节: 2-0 (红+2分)           │
│                                  │
│ 总进球: 8-5                      │
│ 最终得分: 3-0 (红队获胜)        │
│                                  │
│ MVP: [多选]                      │
│ □ 洪胜  □ 施毅  □ 小黑          │
│                                  │
│ 比赛总结: [文本框]              │
└─────────────────────────────────┘

[返回修改] [提交结果]
```

### 5.3 AI简报解析界面

```
┌─────────────────────────────────┐
│   粘贴比赛简报                   │
├─────────────────────────────────┤
│ [大文本框，支持多行输入]         │
│                                  │
│ 嘉陵摩托（红）VS 长江（花）      │
│ 星期六2025.10.12，轨道集团       │
│ 比分:3:0                         │
│                                  │
│ 到场人员：                       │
│ 花：待补充                       │
│ 红： 黄波 施毅 洪胜...          │
│                                  │
└─────────────────────────────────┘

[AI解析] [手动修正]

解析结果预览:
┌─────────────────────────────────┐
│ ✓ 识别队伍: 嘉陵摩托 vs 长江    │
│ ✓ 识别日期: 2025-10-12           │
│ ✓ 识别地点: 轨道集团             │
│ ✓ 识别节次: 4节                  │
│ ✓ 识别最终得分: 3-0              │
│ ✓ 识别到场人员: 12人             │
│ ✓ 识别进球事件: 8个              │
│ ⚠ 需要手动匹配: 3个昵称          │
└─────────────────────────────────┘

[确认导入] [放弃]
```

---

## 6. AI解析逻辑设计

### 6.1 解析步骤

```javascript
class MatchReportParser {
  parse(reportText) {
    return {
      basicInfo: this.extractBasicInfo(reportText),
      participants: this.extractParticipants(reportText),
      quarters: this.extractQuarters(reportText),
      events: this.extractEvents(reportText),
      statistics: this.extractStatistics(reportText),
      mvp: this.extractMVP(reportText)
    };
  }

  extractBasicInfo(text) {
    // 正则匹配: "队名（别名）VS 队名（别名）日期，地点 比分:X:X"
    const pattern = /(.+?)（(.+?)）VS\s+(.+?)（(.+?)）.+?(\d{4}\.\d{1,2}\.\d{1,2})[，,]\s*(.+?)\s*比分[：:]\s*(\d+)[：:]\s*(\d+)/;
    const match = text.match(pattern);

    return {
      team1Name: match[1].trim(),
      team1Alias: match[2].trim(),
      team2Name: match[3].trim(),
      team2Alias: match[4].trim(),
      date: match[5],
      location: match[6].trim(),
      finalScore: `${match[7]}:${match[8]}`
    };
  }

  extractParticipants(text) {
    // 匹配 "到场人员：\n花：...\n红：..."
    const participants = { team1: [], team2: [] };

    const team2Match = text.match(/花[：:]\s*(.+?)(?:\n|红)/);
    if (team2Match) {
      participants.team2 = team2Match[1]
        .split(/\s+/)
        .filter(name => name && name !== '待补充');
    }

    const team1Match = text.match(/红[：:]\s*(.+?)(?:\n|第)/);
    if (team1Match) {
      participants.team1 = team1Match[1].split(/\s+/).filter(Boolean);
    }

    return participants;
  }

  extractQuarters(text) {
    // 匹配 "第X节..." 段落
    const quarters = [];
    const quarterPattern = /第([一二三四1234])节(.+?)(?=第[一二三四1234]节|数据：|$)/gs;

    let match;
    while ((match = quarterPattern.exec(text)) !== null) {
      const quarterNum = this.chineseToNumber(match[1]);
      const summary = match[2].trim();

      // 从摘要中统计进球数
      const goals = this.countGoalsInText(summary);

      quarters.push({
        quarterNumber: quarterNum,
        summary: summary,
        team1Goals: goals.team1,
        team2Goals: goals.team2
      });
    }

    return quarters;
  }

  extractStatistics(text) {
    // 匹配 "数据：\n姓名 X球Y助Z裁..."
    const stats = {};
    const statsSection = text.match(/数据[：:]\s*(.+?)(?=MVP|$)/s);

    if (statsSection) {
      const lines = statsSection[1].split('\n').filter(Boolean);

      lines.forEach(line => {
        const nameMatch = line.match(/^([^\d]+)\s+/);
        if (!nameMatch) return;

        const name = nameMatch[1].trim();
        stats[name] = {
          goals: this.extractNumber(line, /(\d+)球/),
          assists: this.extractNumber(line, /(\d+)助/),
          referee: this.extractNumber(line, /(\d+)裁/),
          saves: this.extractNumber(line, /(\d+)门/)
        };
      });
    }

    return stats;
  }

  extractMVP(text) {
    // 匹配 "MVP: 姓名 姓名 姓名"
    const mvpMatch = text.match(/MVP[：:]\s*(.+?)(?:\n|$)/);
    if (mvpMatch) {
      return mvpMatch[1].split(/\s+/).filter(Boolean);
    }
    return [];
  }

  chineseToNumber(chinese) {
    const map = { '一': 1, '二': 2, '三': 3, '四': 4 };
    return map[chinese] || parseInt(chinese);
  }

  countGoalsInText(text) {
    // 基于文本分析进球数（简化版，实际需要更复杂的NLP）
    // 可以统计"打进"、"进球"、"破门"等关键词
    return { team1: 0, team2: 0 }; // 需要实现
  }

  extractNumber(text, pattern) {
    const match = text.match(pattern);
    return match ? parseInt(match[1]) : 0;
  }
}
```

### 6.2 AI增强（可选）

使用大语言模型（如Claude API、OpenAI API）进行智能解析：

```javascript
async function parseReportWithAI(reportText) {
  const prompt = `
请解析以下足球比赛简报，提取结构化信息：

${reportText}

请以JSON格式返回以下信息：
1. basicInfo: {team1Name, team1Alias, team2Name, team2Alias, date, location, finalScore}
2. participants: {team1: [], team2: []}
3. quarters: [{quarterNumber, team1Goals, team2Goals, summary}]
4. events: [{quarterNumber, playerName, eventType, minute, assistPlayer}]
5. statistics: {playerName: {goals, assists, saves, referee}}
6. mvp: []
`;

  const response = await callAIAPI(prompt);
  return JSON.parse(response);
}
```

---

## 7. 实现优先级

### Phase 1: 核心功能（第1周）
- ✅ 数据库表结构创建和迁移
- ✅ Match模型扩展（支持quarterSystem）
- ✅ MatchQuarter模型创建
- ✅ 基础CRUD接口
- ✅ 节次得分计算逻辑

### Phase 2: 手动录入（第2周）
- 创建完整的手动录入API
- 实现逐节录入接口
- 实现批量完整录入接口
- 前端录入页面（小程序）

### Phase 3: AI解析（第3周）
- 简报解析正则逻辑
- AI解析接口（可选集成LLM）
- 昵称匹配和用户关联
- 解析结果预览和修正

### Phase 4: 优化增强（第4周）
- 数据统计报表
- 历史比赛对比
- 数据可视化
- 导出功能

---

## 8. 示例数据流程

### 8.1 手动录入流程

```
1. 创建比赛
   POST /api/match/create
   → matchId

2. 录入第1节
   POST /api/match/{matchId}/quarter
   body: { quarterNumber: 1, team1Goals: 3, team2Goals: 2, events: [...] }
   → 自动计算: team1Points=1, team2Points=0

3. 录入第2节
   POST /api/match/{matchId}/quarter
   body: { quarterNumber: 2, team1Goals: 2, team2Goals: 2, events: [...] }
   → 自动计算: team1Points=0, team2Points=0

4. 录入第3节
   POST /api/match/{matchId}/quarter
   body: { quarterNumber: 3, team1Goals: 1, team2Goals: 1, events: [...] }
   → 自动计算: team1Points=0, team2Points=0

5. 录入第4节
   POST /api/match/{matchId}/quarter
   body: { quarterNumber: 4, team1Goals: 2, team2Goals: 0, events: [...] }
   → 自动计算: team1Points=2, team2Points=0

6. 完成比赛
   POST /api/match/{matchId}/complete
   → 汇总: finalTeam1Score=3, finalTeam2Score=0
   → 创建 MatchResult 记录
```

### 8.2 AI解析流程

```
1. 提交简报
   POST /api/match/parse-report
   body: { reportText: "嘉陵摩托（红）VS 长江（花）...", autoCreate: false }

2. 返回解析结果（待确认）
   → {parsed: {...}, warnings: ["无法匹配昵称: 小黑"]}

3. 前端展示待确认数据
   → 用户手动修正错误

4. 确认并创建
   POST /api/match/create-from-parsed
   body: { parsed: {...}, corrections: {...} }
   → 创建完整比赛记录（match + quarters + events + result）
```

---

## 9. 关键优势

1. **灵活的计分系统**：支持传统全场制和4节制，通过 `quarterSystem` 字段区分
2. **详细的数据记录**：每节单独记录，便于分析趋势和关键时刻
3. **智能解析**：支持从文字简报快速导入，减少手动工作
4. **渐进式录入**：既可逐节录入（实时录入），也可赛后批量录入
5. **数据完整性**：关联到场人员、事件、统计，形成完整数据链
6. **可扩展性**：预留AI字段，未来可接入视频分析、实时数据采集等

---

## 10. 技术栈建议

- **后端**: Node.js + Koa2 + Sequelize (已有)
- **AI解析**:
  - 方案1: 正则表达式 + 规则引擎（快速、免费）
  - 方案2: Claude API / OpenAI API（智能、准确）
- **前端**: 微信小程序 + TDesign组件库
- **数据库**: MySQL 8.0+

---

**文档版本**: v1.0
**创建日期**: 2025-10-17
**作者**: Claude Code
**状态**: 设计阶段 ✅
